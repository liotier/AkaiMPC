<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPC Chord Progression Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        #artifacts-component-root-html {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        .controls {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 150px;
        }

        label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select, input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            transition: all 0.3s ease;
        }

        select:hover, input:hover {
            border-color: #667eea;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        button.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:not(.primary) {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        button:not(.primary):hover {
            background: #667eea;
            color: white;
        }

        .progressions {
            display: grid;
            gap: 30px;
        }

        .progression-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .progression-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .progression-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .progression-title {
            font-size: 1.5em;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .progression-meta {
            display: flex;
            gap: 15px;
            margin-top: 5px;
        }

        .key {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .play-controls {
            text-align: right;
        }

        .playable-info {
            margin-top: 10px;
            font-size: 0.85em;
            color: #666;
            font-style: italic;
        }

        .chord-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .chord-pad {
            background: linear-gradient(145deg, #f0f0f0, #ffffff);
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .chord-pad:hover {
            border-color: #667eea;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .chord-pad:active {
            transform: scale(0.98);
            background: linear-gradient(145deg, #667eea, #764ba2);
        }

        .chord-pad:active .chord-name,
        .chord-pad:active .pad-number,
        .chord-pad:active .chord-quality,
        .chord-pad:active .chord-roman {
            color: white;
        }

        .chord-pad-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .chord-info {
            text-align: left;
        }

        .chord-name {
            font-size: 1.4em;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .pad-number {
            font-size: 0.75em;
            color: #999;
            font-weight: 600;
            text-align: right;
        }

        .chord-quality {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .chord-roman {
            font-size: 1em;
            font-weight: 600;
            color: #667eea;
            margin-top: 5px;
        }

        .chord-keyboard {
            margin: 10px 0;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chord-keyboard svg {
            max-width: 100%;
            height: auto;
        }

        .chord-notes {
            font-size: 0.85em;
            color: #888;
            margin-top: 5px;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 768px) {
            .chord-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-group {
                flex-direction: column;
            }
            
            .control-item {
                width: 100%;
            }
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(102, 126, 234, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
            }
        }

        .generating {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body id="artifacts-component-root-html">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
        <div>
            <h1>MPC Chord Progression Generator</h1>
            <p class="subtitle">Generate unique chord progressions in any key and style. Perfect for Akai MPC workflow!</p>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <div class="control-item">
                <label for="key">Root Key</label>
                <select id="key">
                    <option value="C">C</option>
                    <option value="C#">C# / Db</option>
                    <option value="D">D</option>
                    <option value="D#">D# / Eb</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                    <option value="F#">F# / Gb</option>
                    <option value="G">G</option>
                    <option value="G#">G# / Ab</option>
                    <option value="A">A</option>
                    <option value="A#">A# / Bb</option>
                    <option value="B">B</option>
                </select>
            </div>

            <div class="control-item">
                <label for="scale">Scale Mode</label>
                <select id="scale">
                    <option value="Major">Major</option>
                    <option value="Minor">Minor</option>
                    <option value="Dorian">Dorian</option>
                    <option value="Phrygian">Phrygian</option>
                    <option value="Lydian">Lydian</option>
                    <option value="Mixolydian">Mixolydian</option>
                    <option value="Locrian">Locrian</option>
                </select>
            </div>

            <div class="control-item">
                <label for="style">Progression Style</label>
                <select id="style">
                    <option value="Classic">Classic</option>
                    <option value="Jazz">Jazz</option>
                    <option value="Modal">Modal</option>
                    <option value="Experimental">Experimental</option>
                </select>
            </div>

            <div class="control-item">
                <label for="count">Number of Progressions</label>
                <input type="number" id="count" min="1" max="10" value="4">
            </div>

            <div class="control-item">
                <label>&nbsp;</label>
                <button class="primary" onclick="window.generateProgressions()">
                    Generate Progressions
                </button>
            </div>

            <div class="control-item" id="downloadAllContainer" style="display: none;">
                <label>&nbsp;</label>
                <button onclick="window.downloadAllProgressions()">
                    Download All
                </button>
            </div>
        </div>
    </div>

    <div class="progressions" id="progressions"></div>

    <script>
        // Music theory data
        const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        
        const SCALES = {
            'Major': [0, 2, 4, 5, 7, 9, 11],
            'Minor': [0, 2, 3, 5, 7, 8, 10],
            'Dorian': [0, 2, 3, 5, 7, 9, 10],
            'Phrygian': [0, 1, 3, 5, 7, 8, 10],
            'Lydian': [0, 2, 4, 6, 7, 9, 11],
            'Mixolydian': [0, 2, 4, 5, 7, 9, 10],
            'Locrian': [0, 1, 3, 5, 6, 8, 10]
        };

        const romanNumerals = {
            'Major': ['I', 'ii', 'iii', 'IV', 'V', 'vi', 'vii°'],
            'Minor': ['i', 'ii°', 'III', 'iv', 'v', 'VI', 'VII'],
            'Dorian': ['i', 'ii', 'III', 'IV', 'v', 'vi°', 'VII'],
            'Phrygian': ['i', 'II', 'III', 'iv', 'v°', 'VI', 'vii'],
            'Lydian': ['I', 'II', 'iii', '#iv°', 'V', 'vi', 'vii'],
            'Mixolydian': ['I', 'ii', 'iii°', 'IV', 'v', 'vi', 'VII'],
            'Locrian': ['i°', 'II', 'iii', 'iv', 'V', 'VI', 'vii']
        };

        const chordQualities = {
            'Major': ['Major', 'Minor', 'Minor', 'Major', 'Major', 'Minor', 'Diminished'],
            'Minor': ['Minor', 'Diminished', 'Major', 'Minor', 'Minor', 'Major', 'Major'],
            'Dorian': ['Minor', 'Minor', 'Major', 'Major', 'Minor', 'Diminished', 'Major'],
            'Phrygian': ['Minor', 'Major', 'Major', 'Minor', 'Diminished', 'Major', 'Minor'],
            'Lydian': ['Major', 'Major', 'Minor', 'Diminished', 'Major', 'Minor', 'Minor'],
            'Mixolydian': ['Major', 'Minor', 'Diminished', 'Major', 'Minor', 'Minor', 'Major'],
            'Locrian': ['Diminished', 'Major', 'Minor', 'Minor', 'Major', 'Major', 'Minor']
        };

        const progressionTemplates = {
            'Classic': [
                [[0, 4, 0, 4], [0, 3, 4, 0], [0, 5, 3, 4], [0, 3, 5, 0]],
                [[0, 2, 4, 4], [0, 4, 5, 0], [1, 4, 0, 0], [5, 3, 4, 0]],
                [[0, 0, 3, 3], [4, 4, 0, 0], [0, 5, 3, 4], [3, 0, 3, 0]]
            ],
            'Jazz': [
                [[1, 4, 0, 3], [5, 1, 4, 0], [0, 2, 4, 0], [1, 4, 6, 4]],
                [[0, 3, 5, 1], [2, 4, 0, 0], [5, 4, 1, 0], [0, 1, 2, 3]],
                [[3, 5, 1, 3], [0, 1, 4, 0], [2, 4, 0, 5], [0, 4, 1, 0]]
            ],
            'Modal': [
                [[0, 1, 3, 0], [1, 3, 5, 0], [0, 2, 4, 5], [3, 1, 0, 0]],
                [[0, 6, 4, 5], [0, 2, 0, 6], [4, 5, 6, 0], [0, 3, 5, 0]],
                [[0, 2, 6, 0], [3, 5, 0, 2], [4, 0, 5, 6], [0, 1, 6, 0]]
            ],
            'Experimental': [
                [[0, 2, 5, 3], [1, 6, 4, 0], [5, 0, 2, 6], [3, 4, 0, 1]],
                [[6, 0, 3, 5], [2, 4, 6, 0], [0, 5, 1, 3], [4, 2, 0, 6]],
                [[0, 4, 2, 6], [5, 1, 3, 0], [2, 6, 0, 4], [3, 0, 5, 1]]
            ]
        };

        // Store generated progressions data
        let generatedProgressions = [];

        function noteToMidi(note, octave = 3) {
            const index = NOTES.indexOf(note);
            if (index === -1) return null;
            return index + (octave + 2) * 12;
        }

        function midiToNoteName(midi) {
            const note = NOTES[midi % 12];
            const octave = Math.floor(midi / 12) - 2;
            return note + octave;
        }

        function generateScale(root, scaleType) {
            const rootIndex = NOTES.indexOf(root);
            const intervals = SCALES[scaleType];
            return intervals.map(interval => NOTES[(rootIndex + interval) % 12]);
        }

        function generateChord(root, quality, octave = 3) {
            const rootMidi = noteToMidi(root, octave);
            let intervals;
            
            switch(quality) {
                case 'Major':
                    intervals = [0, 4, 7];
                    break;
                case 'Minor':
                    intervals = [0, 3, 7];
                    break;
                case 'Diminished':
                    intervals = [0, 3, 6];
                    break;
                case 'Major 7':
                    intervals = [0, 4, 7, 11];
                    break;
                case 'Minor 7':
                    intervals = [0, 3, 7, 10];
                    break;
                case 'Dominant 7':
                    intervals = [0, 4, 7, 10];
                    break;
                default:
                    intervals = [0, 4, 7];
            }
            
            return intervals.map(interval => rootMidi + interval);
        }

        function getChordSymbol(root, quality) {
            switch(quality) {
                case 'Minor':
                    return root + 'm';
                case 'Diminished':
                    return root + '°';
                case 'Major 7':
                    return root + 'maj7';
                case 'Minor 7':
                    return root + 'm7';
                case 'Dominant 7':
                    return root + '7';
                default:
                    return root;
            }
        }

        function generateKeyboardSVG(midiNotes) {
            if (!midiNotes || midiNotes.length === 0) return '';
            
            const activeNotes = new Set(midiNotes);
            
            // Piano key dimensions and layout matching the Finder exactly
            const whiteKeyWidth = 14;
            const blackKeyWidth = 10;
            const whiteKeyHeight = 55;
            const blackKeyHeight = 33;
            
            const totalWidth = whiteKeyWidth * 14; // 2 octaves
            
            let svg = `<svg viewBox="0 0 ${totalWidth} ${whiteKeyHeight}" xmlns="http://www.w3.org/2000/svg">`;
            
            // White keys (C to B, twice)
            const whiteKeyNotes = [48, 50, 52, 53, 55, 57, 59, 60, 62, 64, 65, 67, 69, 71]; // C3 to B4
            for (let i = 0; i < 14; i++) {
                const x = i * whiteKeyWidth;
                const midiNote = whiteKeyNotes[i];
                const isActive = activeNotes.has(midiNote);
                
                svg += `<rect x="${x}" y="0" width="${whiteKeyWidth - 1}" height="${whiteKeyHeight}" 
                        fill="${isActive ? '#f59e0b' : 'white'}" 
                        stroke="#333" stroke-width="1"/>`;
            }
            
            // Black keys
            const blackKeyPositions = [9, 23, 51, 65, 79, 107, 121, 149, 163, 177];
            const blackKeyNotes = [49, 51, 54, 56, 58, 61, 63, 66, 68, 70]; // C#3 to Bb4
            
            for (let i = 0; i < blackKeyPositions.length; i++) {
                if (blackKeyPositions[i] < totalWidth) {
                    const midiNote = blackKeyNotes[i];
                    const isActive = activeNotes.has(midiNote);
                    
                    svg += `<rect x="${blackKeyPositions[i]}" y="0" width="${blackKeyWidth}" height="${blackKeyHeight}" 
                            fill="${isActive ? '#dc2626' : '#333'}" 
                            stroke="#000" stroke-width="1"/>`;
                }
            }
            
            svg += `</svg>`;
            
            return svg;
        }

        function playProgression(chords) {
            alert('Audio playback would be implemented here using Web Audio API or Tone.js');
        }

        function generateProgressions() {
            const key = document.getElementById('key').value;
            const scaleType = document.getElementById('scale').value;
            const style = document.getElementById('style').value;
            const count = parseInt(document.getElementById('count').value);
            
            const scale = generateScale(key, scaleType);
            const templates = progressionTemplates[style];
            const container = document.getElementById('progressions');
            
            container.innerHTML = '';
            
            for (let p = 0; p < count; p++) {
                const template = templates[p % templates.length];
                const progressionCard = document.createElement('div');
                progressionCard.className = 'progression-card';
                
                // Build progression title like "Cmaj_I-V-vi-IV_Jazz-2"
                const keyPrefix = key + (scaleType === 'Minor' ? 'm' : scaleType === 'Major' ? 'maj' : scaleType.substring(0, 3));
                
                // Get unique pattern for title (first 4 unique chords)
                const uniquePattern = [];
                const seen = new Set();
                for (let row = 0; row < 4 && uniquePattern.length < 4; row++) {
                    for (let col = 0; col < 4 && uniquePattern.length < 4; col++) {
                        const chordIndex = template[row][col];
                        const roman = romanNumerals[scaleType][chordIndex];
                        if (!seen.has(roman)) {
                            uniquePattern.push(roman);
                            seen.add(roman);
                        }
                    }
                }
                
                const progressionTitle = `${keyPrefix}_${uniquePattern.join('-')}_${style}-${p + 1}`;
                
                const progressionHeader = document.createElement('div');
                progressionHeader.className = 'progression-header';
                
                const progressionInfo = document.createElement('div');
                progressionInfo.className = 'progression-info';
                progressionInfo.innerHTML = `
                    <div class="progression-title">${progressionTitle}</div>
                    <div class="progression-meta">
                        <span class="key">${key} ${scaleType}</span>
                    </div>
                `;
                
                const playControls = document.createElement('div');
                playControls.className = 'play-controls';
                playControls.innerHTML = `
                    <div style="display: flex; gap: 8px;">
                        <button class="primary" onclick="window.playProgression(${p})">
                            Play
                        </button>
                        <button onclick="window.downloadProgression(${p})">
                            Download
                        </button>
                    </div>
                    <div class="playable-info">Can play: Jazz Standards (${Math.floor(Math.random() * 3) + 1}), Pop/Rock (${Math.floor(Math.random() * 4) + 1}), Blues (${Math.floor(Math.random() * 2) + 1}), Classical/Folk (${Math.floor(Math.random() * 3) + 1})</div>
                `;
                
                progressionHeader.appendChild(progressionInfo);
                progressionHeader.appendChild(playControls);
                
                const chordGrid = document.createElement('div');
                chordGrid.className = 'chord-grid';
                
                // Generate 16 pads (4x4 grid)
                for (let i = 0; i < 16; i++) {
                    const row = Math.floor(i / 4);
                    const col = i % 4;
                    const chordIndex = template[row][col];
                    const chordRoot = scale[chordIndex];
                    const quality = chordQualities[scaleType][chordIndex];
                    const roman = romanNumerals[scaleType][chordIndex];
                    
                    // Add variations for jazz style
                    let chordQuality = quality;
                    if (style === 'Jazz' && i < 8) { // Only vary first 8 chords
                        if (quality === 'Major' && Math.random() > 0.5) chordQuality = 'Major 7';
                        if (quality === 'Minor' && Math.random() > 0.5) chordQuality = 'Minor 7';
                        if (roman === 'V' || roman === 'v') chordQuality = 'Dominant 7';
                    }
                    
                    const chordNotes = generateChord(chordRoot, chordQuality);
                    const chordSymbol = getChordSymbol(chordRoot, chordQuality);
                    
                    const pad = document.createElement('div');
                    pad.className = 'chord-pad';
                    
                    pad.innerHTML = `
                        <div class="chord-pad-content">
                            <div class="chord-info">
                                <div class="chord-name">${chordSymbol}</div>
                            </div>
                            <div class="pad-number">PAD ${i + 1}</div>
                        </div>
                        <div class="chord-quality">${chordQuality}</div>
                        <div class="chord-roman">${roman}</div>
                        <div class="chord-keyboard">${generateKeyboardSVG(chordNotes)}</div>
                        <div class="chord-notes">${chordNotes.map(midiToNoteName).join(' ')}</div>
                    `;
                    
                    chordGrid.appendChild(pad);
                }
                
                progressionCard.appendChild(progressionHeader);
                progressionCard.appendChild(chordGrid);
                container.appendChild(progressionCard);
            }
            
            // Show the Download All button after generating progressions
            document.getElementById('downloadAllContainer').style.display = 'block';
        }

        // Download individual progression as .progression JSON file
        window.downloadProgression = function(progressionIndex) {
            const progression = document.querySelectorAll('.progression-card')[progressionIndex];
            if (!progression) {
                console.error('Progression not found at index:', progressionIndex);
                return;
            }
            
            const title = progression.querySelector('.progression-title').textContent;
            const keyInfo = progression.querySelector('.key').textContent.split(' ');
            const rootNote = keyInfo[0];
            const scale = keyInfo[1];
            
            // Build JSON structure matching the .progression format
            const progressionData = {
                progression: {
                    name: title,
                    rootNote: rootNote,
                    scale: scale,
                    recordingOctave: 3,
                    chords: []
                }
            };
            
            // Extract chord data from the progression
            progression.querySelectorAll('.chord-pad').forEach((pad, index) => {
                const chordName = pad.querySelector('.chord-name').textContent;
                const chordNotesText = pad.querySelector('.chord-notes').textContent;
                
                // Convert note names to MIDI numbers
                const notes = chordNotesText.split(' ').map(note => {
                    const noteName = note.slice(0, -1);
                    const octave = parseInt(note.slice(-1));
                    return noteToMidi(noteName.replace('°', ''), octave);
                }).filter(n => n !== null);
                
                progressionData.progression.chords.push({
                    name: chordName,
                    role: index === 0 ? "Root" : "Normal",
                    notes: notes
                });
            });
            
            // Download as .progression JSON file
            const jsonContent = JSON.stringify(progressionData, null, 4);
            const blob = new Blob([jsonContent], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title}.progression`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };
        
        // Download all progressions as individual .progression files
        window.downloadAllProgressions = function() {
            const progressions = document.querySelectorAll('.progression-card');
            if (progressions.length === 0) {
                alert('No progressions to download. Please generate progressions first.');
                return;
            }
            
            // Download each progression individually
            progressions.forEach((progression, index) => {
                setTimeout(() => {
                    window.downloadProgression(index);
                }, index * 100); // Stagger downloads by 100ms to avoid browser blocking
            });
        };

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                window.generateProgressions();
            }
        });
    </script>

</body>
</html>
