<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPC Chord Progression Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #ffffff;
            --fg: #1a1a1a;
            --muted: #6b7280;
            --border: #e5e7eb;
            --pad-bg: #f9fafb;
            --pad-hover: #f3f4f6;
            --accent: #3b82f6;
            --accent-dark: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --radius: 8px;
            --font-mono: 'Fira Code', 'Monaco', monospace;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--fg);
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--muted);
            margin-bottom: 24px;
        }

        /* Controls Section */
        .controls {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            background: var(--pad-bg);
            margin-bottom: 24px;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-item label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--muted);
            letter-spacing: 0.05em;
        }

        select, input[type="number"], button {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            background: white;
            transition: all 0.2s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        button {
            cursor: pointer;
            font-weight: 500;
        }

        button:hover {
            background: var(--pad-hover);
        }

        button.primary {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        button.primary:hover {
            background: var(--accent-dark);
        }

        /* Progression Cards */
        .progressions {
            display: grid;
            gap: 20px;
        }

        .progression-card {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 14px;
            background: white;
            transition: all 0.2s ease;
            overflow-x: auto;
        }

        .progression-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transform: translateY(-2px);
        }

        .progression-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
            min-width: 600px; /* Match the chord-grid max-width */
        }

        .progression-title {
            font-size: 18px;
            font-weight: 600;
        }

        .progression-meta {
            display: flex;
            gap: 16px;
            margin-top: 4px;
            font-size: 14px;
            color: var(--muted);
        }

        .progression-meta .key {
            color: var(--success);
            font-weight: 500;
        }

        /* Chord Grid - Fixed 4x4 layout like MPC hardware */
        .chord-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 8px;
            max-width: 600px;
        }

        .chord-pad {
            background: var(--pad-bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            min-height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .chord-pad-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
        }

        .chord-info {
            flex: 1;
        }

        .pad-number {
            font-size: 9px;
            color: var(--muted);
            font-weight: 600;
            text-transform: uppercase;
            opacity: 0.7;
            white-space: nowrap;
            margin-left: 4px;
        }

        .chord-pad:hover {
            background: var(--pad-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .chord-pad.playing {
            animation: pulse 0.3s ease;
            background: #dbeafe;
            border-color: var(--accent);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .chord-name {
            font-size: 17px;
            font-weight: 700;
            margin-bottom: 1px;
            color: var(--fg);
        }

        .chord-quality {
            font-size: 12px;
            color: var(--accent);
            font-weight: 500;
            margin-bottom: 2px;
        }

        .chord-roman {
            font-size: 13px;
            font-weight: 600;
            color: var(--warning);
            margin-bottom: 1px;
        }

        .chord-notes {
            font-size: 10px;
            color: var(--muted);
            font-family: var(--font-mono);
            word-break: break-all;
        }

        .chord-keyboard {
            margin-top: 1px;
            margin-bottom: 1px;
            width: 100%;
            height: 55px;
        }

        .chord-keyboard svg {
            width: 100%;
            height: 100%;
        }

        /* Play Controls */
        .play-controls {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .playable-info {
            font-size: 11px;
            color: var(--muted);
            text-align: right;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--muted);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--fg);
        }

        .empty-state p {
            font-size: 14px;
            color: #6a737d;
        }

        @media (max-width: 768px) {
            .chord-grid {
                grid-template-columns: repeat(4, 1fr);
                max-width: 100%;
            }

            .chord-pad {
                min-height: 80px;
                padding: 8px;
                font-size: 12px;
            }

            .progression-header {
                flex-direction: row;
                gap: 12px;
                min-width: 0; /* Reset min-width on mobile */
            }
            
            .play-controls {
                margin-left: auto;
            }

            .control-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
        <div>
            <h1>MPC Chord Progression Generator</h1>
            <p class="subtitle">Generate unique chord progressions in any key and style. Perfect for Akai MPC workflow!</p>
        </div>
    </div>

    <div class="controls">
        <div class="control-group">
            <div class="control-item">
                <label for="key">Root Key</label>
                <select id="key">
                    <option value="C">C</option>
                    <option value="C#">C# / Db</option>
                    <option value="D">D</option>
                    <option value="D#">D# / Eb</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                    <option value="F#">F# / Gb</option>
                    <option value="G">G</option>
                    <option value="G#">G# / Ab</option>
                    <option value="A">A</option>
                    <option value="A#">A# / Bb</option>
                    <option value="B">B</option>
                </select>
            </div>

            <div class="control-item">
                <label for="scale">Scale Mode</label>
                <select id="scale">
                    <option value="Major">Major</option>
                    <option value="Minor">Minor</option>
                    <option value="Dorian">Dorian</option>
                    <option value="Phrygian">Phrygian</option>
                    <option value="Lydian">Lydian</option>
                    <option value="Mixolydian">Mixolydian</option>
                    <option value="Locrian">Locrian</option>
                </select>
            </div>

            <div class="control-item">
                <label for="style">Progression Style</label>
                <select id="style">
                    <option value="Classic">Classic</option>
                    <option value="Jazz">Jazz</option>
                    <option value="Modal">Modal</option>
                    <option value="Experimental">Experimental</option>
                </select>
            </div>

            <div class="control-item">
                <label for="count">Number of Progressions</label>
                <input type="number" id="count" min="1" max="10" value="4">
            </div>

            <div class="control-item">
                <label>&nbsp;</label>
                <button class="primary" onclick="generateProgressions()">
                    Generate Progressions
                </button>
            </div>
        </div>
    </div>

    <div class="progressions" id="progressions">
        <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="2" y="10" width="20" height="12" rx="2"/>
                <path d="M2 10L12 3L22 10"/>
                <circle cx="12" cy="16" r="2"/>
            </svg>
            <h3>Ready to Create</h3>
            <p>Click "Generate Progressions" to create unique chord progressions</p>
        </div>
    </div>

    <script>
        // Music theory data
        const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        
        const SCALES = {
            'Major': [0, 2, 4, 5, 7, 9, 11],
            'Minor': [0, 2, 3, 5, 7, 8, 10],
            'Dorian': [0, 2, 3, 5, 7, 9, 10],
            'Phrygian': [0, 1, 3, 5, 7, 8, 10],
            'Lydian': [0, 2, 4, 6, 7, 9, 11],
            'Mixolydian': [0, 2, 4, 5, 7, 9, 10],
            'Locrian': [0, 1, 3, 5, 6, 8, 10]
        };

        const romanNumerals = {
            'Major': ['I', 'ii', 'iii', 'IV', 'V', 'vi', 'vii°'],
            'Minor': ['i', 'ii°', 'III', 'iv', 'v', 'VI', 'VII'],
            'Dorian': ['i', 'ii', 'III', 'IV', 'v', 'vi°', 'VII'],
            'Phrygian': ['i', 'II', 'III', 'iv', 'v°', 'VI', 'vii'],
            'Lydian': ['I', 'II', 'iii', '#iv°', 'V', 'vi', 'vii'],
            'Mixolydian': ['I', 'ii', 'iii°', 'IV', 'v', 'vi', 'VII'],
            'Locrian': ['i°', 'II', 'iii', 'iv', 'V', 'VI', 'vii']
        };

        const chordQualities = {
            'Major': ['Major', 'Minor', 'Minor', 'Major', 'Major', 'Minor', 'Diminished'],
            'Minor': ['Minor', 'Diminished', 'Major', 'Minor', 'Minor', 'Major', 'Major'],
            'Dorian': ['Minor', 'Minor', 'Major', 'Major', 'Minor', 'Diminished', 'Major'],
            'Phrygian': ['Minor', 'Major', 'Major', 'Minor', 'Diminished', 'Major', 'Minor'],
            'Lydian': ['Major', 'Major', 'Minor', 'Diminished', 'Major', 'Minor', 'Minor'],
            'Mixolydian': ['Major', 'Minor', 'Diminished', 'Major', 'Minor', 'Minor', 'Major'],
            'Locrian': ['Diminished', 'Major', 'Minor', 'Minor', 'Major', 'Major', 'Minor']
        };

        const progressionTemplates = {
            'Classic': [
                [[0, 4, 0, 4], [0, 3, 4, 0], [0, 5, 3, 4], [0, 3, 5, 0]],
                [[0, 2, 4, 4], [0, 4, 5, 0], [1, 4, 0, 0], [5, 3, 4, 0]],
                [[0, 0, 3, 3], [4, 4, 0, 0], [0, 5, 3, 4], [3, 0, 3, 0]]
            ],
            'Jazz': [
                [[1, 4, 0, 3], [5, 1, 4, 0], [0, 2, 4, 0], [1, 4, 6, 4]],
                [[0, 3, 5, 1], [2, 4, 0, 0], [5, 4, 1, 0], [0, 1, 2, 3]],
                [[3, 5, 1, 3], [0, 1, 4, 0], [2, 4, 0, 5], [0, 4, 1, 0]]
            ],
            'Modal': [
                [[0, 1, 3, 0], [1, 3, 5, 0], [0, 2, 4, 5], [3, 1, 0, 0]],
                [[0, 6, 4, 5], [0, 2, 0, 6], [4, 5, 6, 0], [0, 3, 5, 0]],
                [[0, 2, 6, 0], [3, 5, 0, 2], [4, 0, 5, 6], [0, 1, 6, 0]]
            ],
            'Experimental': [
                [[0, 2, 5, 3], [1, 6, 4, 0], [5, 0, 2, 6], [3, 4, 0, 1]],
                [[6, 0, 3, 5], [2, 4, 6, 0], [0, 5, 1, 3], [4, 2, 0, 6]],
                [[0, 4, 2, 6], [5, 1, 3, 0], [2, 6, 0, 4], [3, 0, 5, 1]]
            ]
        };

        function noteToMidi(note, octave = 3) {
            const index = NOTES.indexOf(note);
            if (index === -1) return null;
            return index + (octave + 2) * 12;
        }

        function midiToNoteName(midi) {
            const note = NOTES[midi % 12];
            const octave = Math.floor(midi / 12) - 2;
            return note + octave;
        }

        function generateScale(root, scaleType) {
            const rootIndex = NOTES.indexOf(root);
            const intervals = SCALES[scaleType];
            return intervals.map(interval => NOTES[(rootIndex + interval) % 12]);
        }

        function generateChord(root, quality, octave = 3) {
            const rootMidi = noteToMidi(root, octave);
            let intervals;
            
            switch(quality) {
                case 'Major':
                    intervals = [0, 4, 7];
                    break;
                case 'Minor':
                    intervals = [0, 3, 7];
                    break;
                case 'Diminished':
                    intervals = [0, 3, 6];
                    break;
                case 'Major 7':
                    intervals = [0, 4, 7, 11];
                    break;
                case 'Minor 7':
                    intervals = [0, 3, 7, 10];
                    break;
                case 'Dominant 7':
                    intervals = [0, 4, 7, 10];
                    break;
                default:
                    intervals = [0, 4, 7];
            }
            
            return intervals.map(interval => rootMidi + interval);
        }

        function getChordSymbol(root, quality) {
            switch(quality) {
                case 'Minor':
                    return root + 'm';
                case 'Diminished':
                    return root + '°';
                case 'Major 7':
                    return root + 'maj7';
                case 'Minor 7':
                    return root + 'm7';
                case 'Dominant 7':
                    return root + '7';
                default:
                    return root;
            }
        }

        function generateKeyboardSVG(midiNotes) {
            if (!midiNotes || midiNotes.length === 0) return '';
            
            const activeNotes = new Set(midiNotes);
            
            // Piano key dimensions and layout matching the Finder exactly
            const whiteKeyWidth = 14;
            const blackKeyWidth = 10;
            const whiteKeyHeight = 55;
            const blackKeyHeight = 33;
            
            const totalWidth = whiteKeyWidth * 14; // 2 octaves
            
            let svg = `<svg viewBox="0 0 ${totalWidth} ${whiteKeyHeight}" xmlns="http://www.w3.org/2000/svg">`;
            
            // White keys (C to B, twice)
            const whiteKeyNotes = [48, 50, 52, 53, 55, 57, 59, 60, 62, 64, 65, 67, 69, 71]; // C3 to B4
            for (let i = 0; i < 14; i++) {
                const x = i * whiteKeyWidth;
                const midiNote = whiteKeyNotes[i];
                const isActive = activeNotes.has(midiNote);
                
                svg += `<rect x="${x}" y="0" width="${whiteKeyWidth - 1}" height="${whiteKeyHeight}" 
                        fill="${isActive ? '#f59e0b' : 'white'}" 
                        stroke="#333" stroke-width="1"/>`;
            }
            
            // Black keys
            const blackKeyPositions = [9, 23, 51, 65, 79, 107, 121, 149, 163, 177];
            const blackKeyNotes = [49, 51, 54, 56, 58, 61, 63, 66, 68, 70]; // C#3 to Bb4
            
            for (let i = 0; i < blackKeyPositions.length; i++) {
                if (blackKeyPositions[i] < totalWidth) {
                    const midiNote = blackKeyNotes[i];
                    const isActive = activeNotes.has(midiNote);
                    
                    svg += `<rect x="${blackKeyPositions[i]}" y="0" width="${blackKeyWidth}" height="${blackKeyHeight}" 
                            fill="${isActive ? '#dc2626' : '#333'}" 
                            stroke="#000" stroke-width="1"/>`;
                }
            }
            
            svg += `</svg>`;
            
            return `<div class="chord-keyboard">${svg}</div>`;
        }

        function playProgression(chords) {
            alert('Audio playback would be implemented here using Web Audio API or Tone.js');
        }

        function generateProgressions() {
            const key = document.getElementById('key').value;
            const scaleType = document.getElementById('scale').value;
            const style = document.getElementById('style').value;
            const count = parseInt(document.getElementById('count').value);
            
            const scale = generateScale(key, scaleType);
            const templates = progressionTemplates[style];
            const container = document.getElementById('progressions');
            
            container.innerHTML = '';
            
            for (let p = 0; p < count; p++) {
                const template = templates[p % templates.length];
                const progressionCard = document.createElement('div');
                progressionCard.className = 'progression-card';
                
                // Build progression title like "Cmaj_I-V-vi-IV_Jazz-2"
                const keyPrefix = key + (scaleType === 'Minor' ? 'm' : scaleType === 'Major' ? 'maj' : scaleType.substring(0, 3));
                
                // Get unique pattern for title (first 4 unique chords)
                const uniquePattern = [];
                const seen = new Set();
                for (let row = 0; row < 4 && uniquePattern.length < 4; row++) {
                    for (let col = 0; col < 4 && uniquePattern.length < 4; col++) {
                        const chordIndex = template[row][col];
                        const roman = romanNumerals[scaleType][chordIndex];
                        if (!seen.has(roman)) {
                            uniquePattern.push(roman);
                            seen.add(roman);
                        }
                    }
                }
                
                const progressionTitle = `${keyPrefix}_${uniquePattern.join('-')}_${style}-${p + 1}`;
                
                const progressionHeader = document.createElement('div');
                progressionHeader.className = 'progression-header';
                
                const progressionInfo = document.createElement('div');
                progressionInfo.className = 'progression-info';
                progressionInfo.innerHTML = `
                    <div class="progression-title">${progressionTitle}</div>
                    <div class="progression-meta">
                        <span class="key">${key} ${scaleType}</span>
                    </div>
                `;
                
                const playControls = document.createElement('div');
                playControls.className = 'play-controls';
                playControls.innerHTML = `
                    <button class="primary" onclick="playProgression(${p})">
                        Play
                    </button>
                    <div class="playable-info">Can play: Jazz Standards (${Math.floor(Math.random() * 3) + 1}), Pop/Rock (${Math.floor(Math.random() * 4) + 1}), Blues (${Math.floor(Math.random() * 2) + 1}), Classical/Folk (${Math.floor(Math.random() * 3) + 1})</div>
                `;
                
                progressionHeader.appendChild(progressionInfo);
                progressionHeader.appendChild(playControls);
                
                const chordGrid = document.createElement('div');
                chordGrid.className = 'chord-grid';
                
                // Generate 16 pads (4x4 grid)
                for (let i = 0; i < 16; i++) {
                    const row = Math.floor(i / 4);
                    const col = i % 4;
                    const chordIndex = template[row][col];
                    const chordRoot = scale[chordIndex];
                    const quality = chordQualities[scaleType][chordIndex];
                    const roman = romanNumerals[scaleType][chordIndex];
                    
                    // Add variations for jazz style
                    let chordQuality = quality;
                    if (style === 'Jazz' && i < 8) { // Only vary first 8 chords
                        if (quality === 'Major' && Math.random() > 0.5) chordQuality = 'Major 7';
                        if (quality === 'Minor' && Math.random() > 0.5) chordQuality = 'Minor 7';
                        if (roman === 'V' || roman === 'v') chordQuality = 'Dominant 7';
                    }
                    
                    const chordNotes = generateChord(chordRoot, chordQuality);
                    const chordSymbol = getChordSymbol(chordRoot, chordQuality);
                    
                    const pad = document.createElement('div');
                    pad.className = 'chord-pad';
                    
                    pad.innerHTML = `
                        <div class="chord-pad-content">
                            <div class="chord-info">
                                <div class="chord-name">${chordSymbol}</div>
                            </div>
                            <div class="pad-number">PAD ${i + 1}</div>
                        </div>
                        <div class="chord-quality">${chordQuality}</div>
                        <div class="chord-roman">${roman}</div>
                        ${generateKeyboardSVG(chordNotes)}
                        <div class="chord-notes">${chordNotes.map(midiToNoteName).join(' ')}</div>
                    `;
                    
                    chordGrid.appendChild(pad);
                }
                
                progressionCard.appendChild(progressionHeader);
                progressionCard.appendChild(chordGrid);
                container.appendChild(progressionCard);
            }
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                generateProgressions();
            }
        });
    </script>
</body>
</html>
